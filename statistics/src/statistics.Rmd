---
title: "UE Simulation aléatoire - PROJET"
output: html_document
date: "30-11-2025"
author:"Axel PIGEON, Marco SANFILIPPO, Mathis Francine-Habas"
---

# Etude d'un réacteur nucléaire

## Prérequis

```{r}
library(tidyverse)
library(ggplot2)
```

```{r}
reacteur_3600 <- read.csv("C:\\Users\\Mathis\\OneDrive\\Documents\\PROJET\\Projet-Simulation-Aleatoire\\statistics\\statistics_output\\2025_11_29_17_51_29\\reactor_history_2025_11_29_17_51_29.csv")
#view(reacteur_3600)

traj_3600 <- read.csv("C:\\Users\\Mathis\\OneDrive\\Documents\\PROJET\\Projet-Simulation-Aleatoire\\statistics\\statistics_output\\2025_11_29_17_51_29\\neutrons_trajectories_2025_11_29_17_51_29.csv")
#view(traj_3600)
```

## Etude

### Catégorisation du nombre de neutrons produit par fission

Nous avons simulé et récupéré les données de notre reacteur pour 3600 itérations, sachant que chaque itération fait une seconde, donc pour une heure de fonctionnement. Sur cette simulation en particulier, le reacteur a eu un peu de mal aux alentours des 2700 itérations, mais il est interressant de remarquer qu'il a pu regagner en puissance et se restabiliser par la suite

```{r}
sommes_fissions <- reacteur_3600 %>%
  summarise(
    Fission_2 = sum(fissions_prod_2, na.rm = TRUE),
    Fission_3 = sum(fissions_prod_3, na.rm = TRUE),
    Fission_4 = sum(fissions_prod_4, na.rm = TRUE),
    Fission_5 = sum(fissions_prod_5, na.rm = TRUE)
  )

tableau_vertical <- sommes_fissions %>%
  pivot_longer(cols = everything(), names_to = "Type_Fission", values_to = "Total")

print(tableau_vertical)
```

L'analyse de la multiplicité lors de la fission des neutrons montre une prédominance écrasante des fissions libérant 2 neutrons (plus de 99,7 % des cas). Bien que rares, des événements générant 3, 4 ou 5 neutrons sont observés, confirmant la nature stochastique du processus. La simulation a été paramétrée avec une borne supérieure fixée à 5 neutrons par fission.

### Distribution de la durée de vie des neutrons

```{r}
duree_vie_df <- traj_3600 %>%
  group_by(neutron_id) %>%
  summarise(
    duree_totale = n()  
  )

ggplot(duree_vie_df, aes(x = duree_totale)) +
  geom_histogram(binwidth = 1, fill = "purple") +
  
  scale_y_sqrt() + 
  
  theme_minimal() +
  labs(title = "Distribution (Échelle Racine Carrée)",
       x = "Durée totale",
       y = "Nombre de neutrons")

```

Les résultats montrent une disparité significative dans la survie des neutrons. Si la durée de vie moyenne reste faible (4,2 itérations), reflétant une absorption rapide pour la majorité de la population, on note la persistance de certains neutrons jusqu'à 48 itérations (plus de 10 fois la moyenne). Cette asymétrie marquée confirme que le transport des neutrons est dominé par des interactions à court terme, ponctuées d'événements de diffusion plus rares mais longs.

### Temps de résidence moyen par état

```{r}
duree_par_type_indiv <- traj_3600 %>%
  group_by(neutron_id, type) %>%
  summarise(duree_etat = n(), .groups = "drop")

moyenne_par_type <- duree_par_type_indiv %>%
  group_by(type) %>%
  summarise(
    duree_moyenne = mean(duree_etat),
    ecart_type = sd(duree_etat),
    nombre_neutrons_concernes = n()
  )

moyenne_par_type$type <- factor(moyenne_par_type$type, 
                                levels = c("fast", "epithermal", "thermal"))

ggplot(moyenne_par_type, aes(x = type, y = duree_moyenne, fill = type)) +
  geom_col(color = "black", alpha = 1) +
  
  geom_text(aes(label = round(duree_moyenne, 1)), vjust = -0.5, fontface = "bold") + 
  
  scale_fill_manual(values = c(
    "fast"       = "#4575b4", 
    "epithermal" = "#fdae61", 
    "thermal"    = "#d73027"  
  )) +
  
  theme_minimal() +
  labs(title = "Temps de résidence moyen par état",
       y = "Durée moyenne (pas de temps)",
       x = "Type de neutron")
```

L'analyse par niveau d'énergie révèle une dynamique contrastée : la phase thermique est prédominante (5,8 pas), correspondant à une longue période de diffusion stable, tandis que le processus de modération (phases rapide et épithermique) est beaucoup plus bref (cumul de 4 pas), les neutrons perdant leur énergie très vite par collisions.

On observe par ailleurs que la somme des durées moyennes par état (9,8 pas) est nettement supérieure à l'espérance de vie globale (4,2 pas). Ce phénomène s'explique par la "mortalité" en cours de route : de nombreux neutrons sont absorbés ou fuient le réacteur dès les phases rapides ou épithermiques. N'atteignant jamais le stade thermique, ils tirent la moyenne globale vers le bas.

### Graphe de la dynamique de thermalisation

```{r}
evolution_pop <- traj_3600 %>%
  count(time_step, type) %>%
  mutate(type = factor(type, levels = c("fast", "epithermal", "thermal")))

ggplot(evolution_pop, aes(x = time_step, y = n, fill = type)) +
  geom_area(alpha = 0.9, size = 0) + 
  
  scale_fill_manual(
    values = c(
      "fast"       = "#d73027", 
      "epithermal" = "#fdae61", 
      "thermal"    = "#4575b4" 
    ),
    
    labels = c(
      "fast"       = "thermal",    
      "epithermal" = "epithermal", 
      "thermal"    = "fast"       
    ),
    
    name = "Type de Neutron"
  ) +
  
  theme_minimal() +
  labs(title = "Dynamique de thermalisation",
       x = "Temps", 
       y = "Nombre de neutrons")
```

On constate que la composition du flux neutronique est conservée au fil du temps. Si le nombre total de neutrons varie, la part respective de chaque catégorie reste stable, sans qu'aucun type ne devienne soudainement prédominant ou ne disparaisse.

### Distribution spatiale de tous les neutrons

```{r}
ggplot(traj_3600, aes(x = x, y = y)) +
  geom_bin2d(binwidth = c(1, 1)) + 
  scale_fill_viridis_c(option = "magma") +
  coord_fixed() +
  theme_minimal() +
  labs(title = "Distribution spatiale de tous les neutrons",
       subtitle = "Données cumulées (tous les pas de temps)",
       fill = "NB Neutrons")
```

Malgrès le positionnement et les déplacements aléatoires des neutrons, leur positionnement est massivement concentré au coeur du réacteur, même si ils occupent tout l'espace disponible. Leur nombre diminue progressivement à mesure qu'on s'approche des bords.

### Trajectoires des 5 neutrons les plus actifs

```{r}
stats_neutrons <- traj_3600 %>%
  arrange(neutron_id, time_step) %>% 
  group_by(neutron_id) %>%
  mutate(
    dx = x - lag(x, default = first(x)),
    dy = y - lag(y, default = first(y)),
    dist_step = sqrt(dx^2 + dy^2)
  ) %>%
  summarise(
    distance_totale = sum(dist_step, na.rm = TRUE),
    duree_vie = n(),
    .groups = "drop"
  )
top_neutrons_ids <- stats_neutrons %>%
  arrange(desc(distance_totale)) %>%
  head(5) %>%
  pull(neutron_id)

data_trajectoires <- traj_3600 %>%
  filter(neutron_id %in% top_neutrons_ids) %>%
  arrange(neutron_id, time_step)

ggplot(data_trajectoires, aes(x = x, y = y, group = neutron_id, color = as.factor(neutron_id))) +
  
  geom_path(size = 1, alpha = 0.8) + 
  
  geom_point(data = data_trajectoires %>% group_by(neutron_id) %>% slice(1), 
             shape = 15, size = 3) +
  
  geom_point(data = data_trajectoires %>% group_by(neutron_id) %>% slice(n()), 
             shape = 16, size = 3) +
  
  coord_fixed(xlim = c(0, 14), ylim = c(0, 14)) +
  theme_bw() +
  labs(title = "Trajectoires des 5 neutrons les plus actifs",
       subtitle = "Carré = Départ, Rond = Arrivée",
       color = "ID Neutron",
       x = "Position X", y = "Position Y")

```

Nous avons isolé les 5 neutrons ayant la plus longue durée de vie pour analyser leurs déplacements. Le graphique montre des trajectoires en zigzag, sans direction précise ni motif particulier. Ce mouvement totalement aléatoire est logique et confirme que notre programme de simulation fonctionne comme prévu.

Piste d'amélioration : Pour la suite, il serait intéressant de comparer ces résultats avec des modèles physiques plus poussés. Cela permettrait de voir si les vrais neutrons se déplacent de façon aussi chaotique ou s'ils suivent des règles de trajectoire un peu moins imprévisibles.

### Tableau de bord du réacteur

```{r}
dashboard_data <- reacteur_3600 %>%
  select(time_step, power_mw, temperature_k, pos_RE01) %>%
  pivot_longer(cols = -time_step, names_to = "variable", values_to = "valeur") %>%
  mutate(variable = factor(variable, levels = c("pos_RE01", "power_mw", "temperature_k")))

ggplot(dashboard_data, aes(x = time_step, y = valeur, color = variable)) +
  geom_line(aes(size = variable)) + 
  
  facet_grid(variable ~ ., scales = "free_y") + 
  
  scale_color_manual(values = c("pos_RE01" = "#4DAF4A", 
                                "power_mw" = "#E41A1C", 
                                "temperature_k" = "#377EB8")) +
  
  scale_size_manual(values = c("pos_RE01" = 1,       
                               "power_mw" = 0.5,     
                               "temperature_k" = 1)) + 
  
  theme_bw() +
  labs(title = "Tableau de bord du réacteur",
       subtitle = "Corrélation : Commande (Barres) -> Réaction (Puissance) -> Conséquence (Temp)",
       x = "Temps (s)", y = "") +
  theme(legend.position = "none") 
```

L'étude des données sur les 3600 étapes de la simulation révèle un comportement dynamique marqué par d'importantes fluctuations des paramètres principaux.

Puissance thermique (power_mw) : La production d'énergie est instable, avec une moyenne s'établissant à 610,1 MW et une médiane légèrement inférieure à 576,0 MW. La plage de variation est très large, allant de l'arrêt complet (0 MW) jusqu'à un pic de 1584 MW, ce qui indique une forte variabilité du régime de fonctionnement.

Température du cœur (temperature_k) : Ce paramètre montre une plus grande stabilité due à l'inertie thermique. La moyenne se situe à 1453 K (médiane à 1487 K). Une fois la phase de démarrage passée, le réacteur se maintient majoritairement dans une plage de températures élevées, entre 1400 et 1600 K.

Barres de contrôle (pos_RE01) : Le système de pilotage est fortement sollicité. La position moyenne des barres est de 51,47 % (médiane à 63,14 %). L'utilisation de l'intégralité de la course des barres (de 0 à 100 %) témoigne d'un effort constant pour réguler la réactivité du cœur.

### Evolution lissée de la puissance du réacteur

```{r}
ggplot(reacteur_3600, aes(x = time_step, y = power_mw)) +
  geom_point(alpha = 0.4) + 
  
  geom_smooth(method = "loess", span = 0.1, color = "#E41A1C", size = 1.5) +
  
  theme_minimal() +
  labs(title = "Évolution lissée de la puissance")

```

Ce premier graphique illustre la méthode utilisée pour rendre les données exploitables. Le nuage de points noirs représente les mesures brutes du tableau de bord à chaque pas de temps : on y voit un signal très "bruité", dispersé par la nature stochastique de la simulation.

Pour analyser le comportement réel du réacteur sans se perdre dans ces fluctuations, nous avons tracé une courbe de tendance (en rouge). Ce lissage permet d'éliminer le bruit numérique pour révéler la dynamique physique sous-jacente de la puissance.

### Dynamique du réacteur

```{r}
max_power <- max(reacteur_3600$power_mw, na.rm = TRUE)
max_neutrons <- max(reacteur_3600$nb_neutrons, na.rm = TRUE)
max_rods <- 100 

coeff_neutrons <- max_power / max_neutrons
coeff_rods <- max_power / max_rods

ggplot(reacteur_3600, aes(x = time_step)) +
  geom_smooth(aes(y = power_mw, color = "Puissance (MW)"), 
              method = "loess", span = 0.1, size = 1, se = FALSE) +

  geom_smooth(aes(y = nb_neutrons * coeff_neutrons, color = "Neutrons"), 
              method = "loess", span = 0.1, size = 1, se = FALSE) +
 
  geom_smooth(aes(y = pos_RE01 * coeff_rods, color = "Barres (%)"), 
              method = "loess", linetype = "dashed", span = 0.1, size = 1, se = FALSE) +
  
  scale_y_continuous(
    name = "Puissance (MW)", 
    
    sec.axis = sec_axis(~ . / coeff_rods, name = "Position Barres (%)")
  ) +

  scale_color_manual(name = "Légende", values = c(
    "Puissance (MW)" = "#E41A1C", # Rouge
    "Neutrons" = "orange",       # Bleu
    "Barres (%)" = "#4DAF4A"      # Vert
  )) +
  
  theme_minimal() +
  theme(
    legend.position = "top",
    axis.title.y.left = element_text(color = "#E41A1C", face = "bold"),
    axis.title.y.right = element_text(color = "#4DAF4A", face = "bold")
  ) +
  labs(title = "Dynamique du Réacteur : Barres vs Puissance/Neutrons",
       subtitle = "Observez l'effet miroir : Quand la courbe Verte descend (Barres sorties), la Rouge monte.")

```

Une fois le signal propre obtenu, nous pouvons le confronter aux autres variables du système. Notez que pour permettre cette superposition visuelle, le nombre de neutrons et la puissance ont été rapportés à une échelle commune (normalisation), leurs ordres de grandeur bruts étant très différents.

Ce graphique comparatif révèle ainsi deux phénomènes physiques majeurs :

Corrélation Flux/Puissance : Les courbes rouge (Puissance) et jaune (Neutrons) épousent parfaitement les mêmes variations, confirmant que la puissance thermique est bien proportionnelle au flux neutronique instantané.

L'effet miroir du pilotage : On observe une corrélation inverse nette avec la position des barres de contrôle (en vert). Lorsque la courbe verte descend (retrait des barres), la puissance monte immédiatement, et inversement. Cela démontre la réactivité directe du cœur aux commandes de pilotage.

### Courbe d'efficacité des barres de contrôle

```{r}
ggplot(reacteur_3600, aes(x = pos_RE01, y = power_mw)) +
  geom_point(alpha = 0.5, color = "darkgreen") +
  
  geom_smooth(method = "loess", color = "red", se = FALSE) +
  
  scale_x_reverse() +
  
  theme_bw() +
  labs(title = "Courbe d'efficacité des barres de contrôle",
       subtitle = "Sensibilité du réacteur à la position des barres",
       x = "Position Barres (0 = Totalement Sorties / 100 = Insérées)",
       y = "Puissance Générée (MW)")

```

L'analyse de l'efficacité des barres de contrôle révèle une corrélation imparfaite. Si l'on voit bien que sortir les barres (aller vers 0 sur l'axe X) fait généralement monter la puissance, la relation n'est pas linéaire.

Les certitudes se limitent aux extrêmes : une puissance faible correspond systématiquement à des barres enfoncées, tandis qu'une puissance forte (\> 800 MW) nécessite des barres relevées. Entre ces deux états, notamment entre 550 et 800 MW, le nuage de points est très étalé, ce qui signifie que le réacteur peut se trouver à cette puissance avec des configurations de barres très différentes.

### Corréaltion physique et test de chi2

```{r}
reacteur_3600$cat_barre <- cut(reacteur_3600$pos_RE01, 
                               breaks = 3, 
                               labels = c("Sortie", "Milieu", "Enfoncée"))

reacteur_3600$cat_power <- cut(reacteur_3600$power_mw, 
                               breaks = 3, 
                               labels = c("Faible", "Moyenne", "Forte"))

table_croisee <- table(reacteur_3600$cat_barre, reacteur_3600$cat_power)

mosaicplot(table_croisee, 
           main = "Corrélation Physique : Barres vs Puissance",
           shade = TRUE, 
           las = 1,
           xlab = "Position Barres (0=Sortie / 100=Enfoncée)",
           ylab = "Puissance Thermique")

```

Le graphique met en évidence une structure diagonale très nette :

Les rectangles bleus indiquent une forte sur-représentation des couples logiques : les barres "Sorties" sont massivement associées aux puissances "Moyennes" et "Fortes", tandis que les barres "Enfoncées" correspondent quasi-exclusivement à une puissance "Faible".

Les rectangles rouges signalent une incompatibilité physique : il est statistiquement impossible d'observer une puissance forte avec des barres enfoncées.

```{r}
test_khi2 <- chisq.test(table_croisee)
print(test_khi2)
```

Ce constat visuel est validé par le test de Pearson, qui rejette formellement l'hypothèse nulle d'indépendance entre les variables :

Significativité ($p < 2.2 \times 10^{-16}$) : La probabilité que cette répartition soit due au hasard est quasi-nulle. Le lien est donc statistiquement avéré.

Intensité ($\chi^2 = 906.53$) : La valeur extrêmement élevée de la statistique de test (bien supérieure au seuil critique pour 4 degrés de liberté) quantifie la force de cette relation. Elle indique une dépendance massive : la position des barres est bien le facteur déterminant qui dicte le niveau de puissance du réacteur.

##Conclusion de l'analyse statistique et validation des conjectures

L'exploration statistique approfondie des données de la simulation (séries temporelles, suivi de particules et tests de corrélation) nous permet de confronter le modèle numérique aux hypothèses physiques formulées initialement.

1.  Relation Neutrons-Puissance (Conjecture validée) L'analyse des séries temporelles lissées a mis en évidence une superposition quasi-parfaite entre la courbe de puissance thermique et celle du flux neutronique global. Cette corrélation positive forte confirme que le modèle traduit fidèlement la physique du réacteur : la puissance instantanée est une conséquence directe de la population neutronique présente dans le cœur.

2.  Impact du Modérateur et Thermalisation (Conjecture validée) L'étude des temps de résidence a démontré que la phase thermique est prédominante (durée moyenne de 5,8 pas contre \~4 pas pour la modération), preuve que le modérateur joue son rôle de "piège" utile pour la fission. De plus, l'analyse temporelle des populations (graphique des aires empilées) montre une stabilité remarquable du spectre neutronique : bien que la puissance fluctue, les proportions relatives entre neutrons rapides, épithermiques et thermiques restent constantes, attestant d'un équilibre physique atteint par le modèle.

3.  Efficacité des Barres de Contrôle (Conjecture validée) L'influence des barres sur la réactivité est incontestable. L'effet "miroir" observé sur le tableau de bord (baisse des barres = hausse de la puissance) est corroboré mathématiquement par le test du $\chi^2$ ($\chi^2 \approx 906$, $p < 2.2 \times 10^{-16}$) et le Mosaic Plot. Ces outils ont prouvé une dépendance statistique massive et inversement proportionnelle : le pilotage est bien le facteur déterminant de l'état du réacteur. Cependant, le graphique de dispersion a révélé une zone d'incertitude (entre 550 et 800 MW) où la position des barres présente une forte variance.

4.  Stabilité du Modèle (Conjecture partiellement validée) Si les stabilités spatiales et spectrales sont acquises, la stabilité "opérationnelle" est plus nuancée. Les statistiques descriptives (forte variance de la puissance, écarts-types élevés) et les cycles d'hystérésis sur le diagramme Puissance/Température montrent que le réacteur ne se stabilise pas sur un point fixe mais tend vers un régime oscillatoire permanent. Bien que le système ne diverge pas (il reste borné), il peine à trouver un équilibre stationnaire, probablement en raison de l'inertie thermique et de la réponse stochastique du flux neutronique.

## Bilan global

Pour résumer, notre simulation réussit bien à reproduire la physique d'un réacteur : le lien entre le nombre de neutrons et l'énergie produite est correct, et les commandes (les barres) fonctionnent comme prévu. Les trajets "au hasard" des neutrons confirment aussi que la partie probabiliste du code marche bien.

Le seul point faible reste la stabilité : le réacteur a du mal à se caler sur une puissance fixe. Il a tendance à osciller en permanence, ce qui montre qu'il est peut-être un peu trop sensible dès qu'on touche aux barres de contrôle.
